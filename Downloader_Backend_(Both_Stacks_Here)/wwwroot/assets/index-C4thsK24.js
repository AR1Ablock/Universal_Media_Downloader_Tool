var me=Object.defineProperty,ge=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var ue=(b,d,a)=>d in b?me(b,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):b[d]=a,de=(b,d)=>{for(var a in d||(d={}))ye.call(d,a)&&ue(b,a,d[a]);if(re)for(var a of re(d))he.call(d,a)&&ue(b,a,d[a]);return b},ce=(b,d)=>ge(b,we(d));var I=(b,d,a)=>new Promise((w,r)=>{var c=g=>{try{h(a.next(g))}catch(k){r(k)}},y=g=>{try{h(a.throw(g))}catch(k){r(k)}},h=g=>g.done?w(g.value):Promise.resolve(g.value).then(c,y);h((a=a.apply(b,d)).next())});import{r as f,a as X,o as Y,b as _e,c as v,d as u,e,F as G,f as te,g as m,t as N,n as fe,h as C,u as x,w as be,i as Z,j as oe,k as q,l as se,m as le,v as ne,T as ae,p as ke,q as Q,s as ee,x as ve,y as $e}from"./vendor-D-yHDbPd.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))w(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const y of c.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&w(y)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function w(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}})();const pe=(b,d)=>{const a=b.__vccOpts||b;for(const[w,r]of d)a[w]=r;return a},Ce={id:"downloads"},Se=["src"],Ie={class:"right-controls small-overlay"},Te=["onClick"],Ue=["onClick","disabled"],Oe={class:"info"},De={class:"top-controls"},Ee={class:"title"},Me={class:"right-controls desktop-only"},Le=["onClick"],Re=["onClick","disabled"],xe={class:"progress-bar-container"},Fe={class:"details"},Ne={class:"buttons"},Pe=["onClick","disabled"],Ae=["onClick","disabled"],Ke=["onClick","disabled"],Be=["onClick","disabled"],Ve=["onClick","disabled"],qe=["onClick","disabled"],Je=["onClick","disabled"],ze=3e4,Ge={__name:"Downloads",setup(b){const d=f([]),a=X({});let w="http://localhost:5050/Downloader",r=f(""),c=f(!1),y;function h(){return I(this,null,function*(){try{const t=yield(yield fetch(`${w}/progress?Key=${r.value}`)).json();d.value=t.map(o=>{var V,n,l,i;a[o.id]||(a[o.id]=o.url);const _=o.status==="completed",$=_?(V=o.total)!=null?V:0:(n=o.downloaded)!=null?n:0,A=_?"0":(l=o.speed)!=null?l:"N/A";return ce(de({},o),{title:o.title||o.url,downloaded:$,total:(i=o.total)!=null?i:0,speed:A})})}catch(s){if(s.message.includes("Not Found"))return;B(s,"updateProgress")}})}function g(s){return I(this,null,function*(){if(c)try{const t=`${w}/download-file/${s}`;window.open(t,"_blank")}catch(t){console.log(t.message)}})}function k(){return I(this,null,function*(){try{let t=yield(yield fetch(`${w}/OS_Check`)).json();t.is_download_enabled?c.value=!0:c.value=!1,console.log("OS -->",t)}catch(s){console.log(s.message)}})}Y(()=>{r.value=localStorage.getItem("MediaDownloaderUserKey"),k(),h(),y=setInterval(h,1500)}),_e(()=>clearInterval(y));function U(s,t){try{return fetch(`${w}/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(o){B(o,`postAction(${s})`)}}const T=s=>I(null,null,function*(){return yield U("pause",{jobId:s})}),L=s=>I(null,null,function*(){return yield U("resume",{jobId:s})}),O=s=>I(null,null,function*(){return yield U("delete-ui",{jobId:s})}),D=s=>I(null,null,function*(){return yield U("delete-file",{jobId:s})});let E=!1;function p(s){return I(this,null,function*(){if(!E){E=!0;try{const o=yield(yield U("open-file",{jobId:s})).json();o.message&&o.message.includes("not found")&&alert(o.message)}catch(t){console.error("Failed to open file directory",t),alert("Error: could not open folder")}finally{E=!1}}})}const F=s=>{var t,o;try{const _=(o=(t=d.value.find($=>$.id===s))==null?void 0:t.progress)!=null?o:0;S[s]=!0,W(s,_),U("resume-fresh",{jobId:s})}catch(_){console.log(_.message)}};function M(s){return I(this,null,function*(){var t,o;try{const _=prompt("Enter new URL to resume the download:");if(_!=null&&_.trim()){const $=(o=(t=d.value.find(A=>A.id===s))==null?void 0:t.progress)!=null?o:0;S[s]=!0,W(s,$),yield U("resume-new-url",{jobId:s,newUrl:_.trim()})}else alert("No URL entered. Resume cancelled.")}catch(_){console.log(_.message)}})}function K(s){const t=a[s];t?navigator.clipboard.writeText(t).then(()=>alert("âœ… Video URL copied!")).catch(()=>alert("âŒ Failed to copy")):alert("âš ï¸ Original URL not found.")}let P=0;function B(s,t="action"){const _=s instanceof TypeError&&s.message.includes("fetch")||s.message.includes("Failed to fetch")?"ğŸš¨ Server unreachable. Try again later.":s.message||"Unknown error occurred.",$=Date.now();(!P||$-P>ze)&&(alert(_),P=$),console.error(`Error during ${t}:`,s.message)}const S=X({}),J={};X({});const R={};function W(s){R[s]&&(R[s](),clearTimeout(J[s])),R[s]=be(()=>{const t=d.value.find(o=>o.id===s);return{progress:t==null?void 0:t.progress,status:t==null?void 0:t.status}},(t,o)=>{(o&&t.progress!==o.progress||t.status==="fail-err"||t.status==="failed")&&(S[s]=!1,R[s](),clearTimeout(J[s]),delete R[s])},{immediate:!1,deep:!0}),J[s]=setTimeout(()=>{S[s]=!1,R[s](),delete R[s]},3e4)}return(s,t)=>(u(),v("div",null,[t[11]||(t[11]=e("h2",{class:"heading"},"Downloads",-1)),e("div",Ce,[(u(!0),v(G,null,te(d.value,o=>{var _,$,A,V;return u(),v("div",{key:o.id,class:"download-card"},[e("img",{src:o.thumbnail,class:"thumbnail"},null,8,Se),e("div",Ie,[e("button",{onClick:n=>K(o.id),class:"icon-button copy",title:"Copy URL"},t[0]||(t[0]=[e("i",{class:"fas fa-copy"},null,-1),m(" Copy ",-1)]),8,Te),e("button",{onClick:n=>O(o.id),class:"icon-button icon-delete-ui remove",title:"Remove from UI",disabled:S[o.id]},t[1]||(t[1]=[e("i",{class:"fas fa-times"},null,-1)]),8,Ue)]),e("div",Oe,[e("div",De,[e("div",Ee,N(o.title),1),e("div",Me,[e("button",{onClick:n=>K(o.id),class:"icon-button copy",title:"Copy URL"},t[2]||(t[2]=[e("i",{class:"fas fa-copy"},null,-1),m(" Copy ",-1)]),8,Le),e("button",{onClick:n=>O(o.id),class:"icon-button icon-delete-ui remove",title:"Remove from UI",disabled:S[o.id]},t[3]||(t[3]=[e("i",{class:"fas fa-times"},null,-1)]),8,Re)])]),e("div",xe,[e("div",{class:"progress-bar",style:fe({width:(($=(_=o.progress)==null?void 0:_.toFixed(2))!=null?$:0)+"%"})},null,4)]),e("div",Fe,[e("span",null,N(o.downloaded)+" MB / "+N(o.total)+" MB",1),e("span",null,"Speed: "+N(o.speed)+N(o.speed!=="N/A"&&o.speed!=="0"?"/s":""),1),e("span",null,"Progress: "+N((V=(A=o.progress)==null?void 0:A.toFixed(2))!=null?V:0)+"%",1),e("span",null,"Job: "+N(o.status),1)]),e("div",Ne,[e("button",{onClick:n=>T(o.id),class:"btn pause",disabled:S[o.id]},t[4]||(t[4]=[e("i",{class:"fas fa-pause"},null,-1),m(" Pause ",-1)]),8,Pe),e("button",{onClick:n=>L(o.id),class:"btn resume",disabled:S[o.id]},t[5]||(t[5]=[e("i",{class:"fas fa-play"},null,-1),m(" Resume ",-1)]),8,Ae),e("button",{onClick:n=>F(o.id),class:"btn restart",disabled:S[o.id]},t[6]||(t[6]=[e("i",{class:"fas fa-redo"},null,-1),m(" Restart ",-1)]),8,Ke),e("button",{onClick:n=>M(o.id),class:"btn resume_broken",disabled:S[o.id]},t[7]||(t[7]=[e("i",{class:"fas fa-link"},null,-1),m(" Fix URL ",-1)]),8,Be),e("button",{onClick:n=>D(o.id),class:"btn delete icon-delete-file",disabled:S[o.id]},t[8]||(t[8]=[e("i",{class:"fas fa-trash"},null,-1),m(" Delete File ",-1)]),8,Ve),x(c)?(u(),v("button",{key:0,onClick:n=>g(o.id),class:"btn download",disabled:o.status!=="completed"},t[9]||(t[9]=[e("i",{class:"fas fa-download"},null,-1),m(" Download ",-1)]),8,qe)):C("",!0),e("button",{onClick:n=>p(o.id),class:"btn download",disabled:o.status!=="completed"},t[10]||(t[10]=[e("i",{class:"fas fa-folder-open"},null,-1),m(" Open ",-1)]),8,Je)])])])}),128))])]))}},We=pe(Ge,[["__scopeId","data-v-d3999bf0"]]),He={class:"login-page",key:"login"},Qe=["onKeydown"],Xe=["onKeydown"],Ye=["disabled"],Ze={key:0},je={key:1,class:"loader"},et={class:"modal-overlay",key:"modal"},tt={class:"modal"},ot={class:"modal-list"},st={key:0},lt={key:1},nt={__name:"Login",emits:["logged-in"],setup(b,{emit:d}){const a=d;let w="";const r=f(""),c=f(""),y=f(!1),h=f(!1),g=f(null),k=f(null);let U=f(!1);Y(()=>{g.value&&g.value.focus()});function T(E){return I(this,null,function*(){const p=new TextEncoder().encode(E),F=yield crypto.subtle.digest("SHA-256",p);return Array.from(new Uint8Array(F)).map(K=>K.toString(16).padStart(2,"0")).join("")})}function L(){k.value&&k.value.focus()}function O(){return I(this,null,function*(){if(!r.value||!c.value){alert("Please enter both username and password.");return}y.value=!0;try{w=yield T(`${r.value}:${c.value}`),h.value=!0}catch(E){console.error(E),alert("Login failed; please try again.")}finally{y.value=!1}})}function D(){h.value=!1,a("logged-in",w)}return(E,p)=>(u(),v(G,null,[Z(ae,{name:"fade",mode:"out-in"},{default:oe(()=>[h.value?C("",!0):(u(),v("div",He,[p[2]||(p[2]=e("h2",{class:"login-title"},"ğŸ”’ Guest Login",-1)),q(e("input",{ref_key:"userInput",ref:g,"onUpdate:modelValue":p[0]||(p[0]=F=>r.value=F),onKeydown:se(le(L,["prevent"]),["enter"]),placeholder:"Username",class:"login-input"},null,40,Qe),[[ne,r.value]]),q(e("input",{ref_key:"passInput",ref:k,"onUpdate:modelValue":p[1]||(p[1]=F=>c.value=F),type:"password",placeholder:"Password",onKeydown:se(le(O,["prevent"]),["enter"]),class:"login-input"},null,40,Xe),[[ne,c.value]]),e("button",{onClick:O,disabled:y.value,class:"btn login-btn"},[y.value?(u(),v("span",je)):(u(),v("span",Ze,"OK"))],8,Ye)]))]),_:1}),Z(ae,{name:"fade-scale"},{default:oe(()=>[h.value?(u(),v("div",et,[e("div",tt,[p[7]||(p[7]=e("h3",{class:"modal-title"},"Session Information",-1)),p[8]||(p[8]=e("p",null," Remember your username and password to view your downloads on any device with same login info. ",-1)),e("ul",ot,[x(U)?(u(),v("li",st,p[3]||(p[3]=[m(" ğŸ”’ Completed downloads expire in ",-1),e("strong",null,"2 hours",-1),m(". ",-1)]))):C("",!0),x(U)?(u(),v("li",lt,p[4]||(p[4]=[m(" â³ Incomplete downloads expire in ",-1),e("strong",null,"6 hours",-1),m(". ",-1)]))):C("",!0),p[5]||(p[5]=e("li",null,[m(" âš™ï¸ Getting resolution, restarting or fix borken link download may take "),e("strong",null,"10â€“30s"),m(". ")],-1)),p[6]||(p[6]=e("li",null," ğŸŒ Some video qualities may be area-restricted. If getting video resolution or download fails, just retryâ€”or enable a VPN and try again. ",-1))]),e("button",{onClick:D,class:"btn modal-btn"},"Understood")])])):C("",!0)]),_:1})],64))}},at=pe(nt,[["__scopeId","data-v-585da855"]]),it={key:1,class:"mobile-panel"},rt={class:"container"},ut={key:1},dt={class:"inner-container"},ct=["src"],vt={class:"rows"},ft={class:"row"},pt=["onKeydown"],mt=["disabled"],gt={key:0},wt={key:1},yt={class:"row"},ht=["value"],_t=["value"],bt={class:"row"},kt=["disabled"],$t={key:0},Ct={key:1},St={key:0,class:"info-modal"},It={class:"info-list"},Tt={key:0},Ut={key:1},Ot=1e3,Dt={__name:"App",setup(b){let d="http://localhost:5050/Downloader";const a=f("");let w=f("");const r=f([]),c=f([]),y=f([]),h=f(""),g=f(""),k=f(""),U=f([]);let T=f(!1),L=f(!1);const O=f(!1),D=f(!1);let E=null,p=!1,F=null;X({});const M=f(null);let K=f(!1);const P=f(!1),B=f(!1);let S=f(!1);function J(){B.value=!B.value}function R(){P.value=!P.value}Y(()=>{setTimeout(()=>{B.value=!0},1e3)}),Y(()=>{var n,l;M.value=localStorage.getItem("MediaDownloaderUserKey"),(l=(n=navigator.userAgentData)==null?void 0:n.brands)!=null&&l.some(i=>i.brand==="Microsoft Edge")&&(K.value=!0)});function W(n){M.value=n,console.log("key ",n),localStorage.setItem("MediaDownloaderUserKey",n)}function s(){setTimeout(()=>{/^https?:\/\/.+\..+/.test(a.value.trim())&&t()},10)}function t(){return I(this,null,function*(){if(O.value){console.log("Already loading formats, please wait.");return}if(a.value.trim()===""||!/^https?:\/\/.+\..+/.test(a.value.trim())){T.value=!0,setTimeout(()=>{T.value=!1,alert("Please enter a valid URL.")},600);return}O.value=!0,k.value="",w.value="",r.value=[],c.value=[],y.value=[];try{const n=yield fetch(`${d}/formats`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:a.value})});if(!n.ok)throw new Error(yield n.text());const l=yield n.json();if(l.loginRequired){T.value=!0,setTimeout(()=>{T.value=!1,window.alert(l.message||"Incorrect URL / Login required"),window.open(l.url,"_blank")},600);return}if(console.log("Received formats:",l),l.length===0){T.value=!0,setTimeout(()=>{T.value=!1,alert("No Media Format Found.")},600);return}h.value="",g.value="",r.value=l,l.forEach(i=>{const H=i.label||"";i.thumbnail&&(k.value=i.thumbnail),i.title&&(w.value=i.title);const j=/\b\d{2,4}x\d{2,4}\b/.test(H),z=i.isAudioOnly||H.toLowerCase().includes("audio only"),ie=i.isVideoOnly||/\b\d{3,4}p\b/.test(H)||j;ie&&!z?c.value.push(i):z&&!ie?y.value.push(i):c.value.push(i)})}catch(n){console.error(n),T.value=!0,A(n,"getFormats","F")}finally{O.value=!1}})}function o(){return`dl_${Date.now()}_${Math.floor(Math.random()*1e6)}`}function _(){return I(this,null,function*(){if(D.value){console.log("Download already in progress, please wait.");return}if(a.value.trim()===""||!/^https?:\/\/.+\..+/.test(a.value.trim())){L.value=!0,setTimeout(()=>{L.value=!1,alert("Please enter a valid URL.")},600);return}p=!1,F=o();try{let n="";if(h.value&&g.value?n=`${h.value}+${g.value}`:h.value?n=h.value:g.value&&(n=g.value),!n){L.value=!0,setTimeout(()=>{L.value=!1,alert("Please select format.")},600);return}D.value=!0;let l={url:a.value,format:n,DownloadId:F,Thumbnail:k.value,Key:M.value};console.log("sending to BE ",l);const i=yield fetch(`${d}/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!i.ok)throw new Error(yield i.text());E&&clearTimeout(E),E=setTimeout(()=>{p||(D.value=!1)},1e4)}catch(n){console.error(n),L.value=!0,A(n,"startDownload","D"),D.value=!1}})}let $=0;function A(n,l="action",i){const j=n instanceof TypeError&&n.message.includes("fetch")||n.message.includes("Failed to fetch")?"ğŸš¨ Server unreachable. Try again later.":n.message||"Unknown error occurred.",z=Date.now();(!$||z-$>Ot)&&(setTimeout(()=>{i=="D"?L.value=!1:i=="F"&&(T.value=!1),alert(j)},600),$=z),console.error(`Error during ${l}:`,n.message)}function V(){P.value=!1,localStorage.removeItem("MediaDownloaderUserKey"),M.value=null,a.value="",w.value="",r.value=[],c.value=[],y.value=[],h.value="",g.value="",k.value="",U.value=[],window.location.reload()}return(n,l)=>(u(),v(G,null,[e("header",null,[l[3]||(l[3]=e("h1",null,"ğŸš€ Media Downloader",-1)),M.value?(u(),v("button",{key:0,onClick:V,class:"signout-btn desktop-signout",title:"Sign Out"}," Sign Out ")):C("",!0),M.value?(u(),v("button",{key:1,onClick:R,class:"menu-toggle mobile-only",title:"Menu"}," â‰¡ ")):C("",!0)]),M.value&&P.value?(u(),v("div",{key:0,class:"mobile-panel-overlay",onClick:R})):C("",!0),M.value&&P.value?(u(),v("div",it,[e("button",{class:"close-panel-btn",onClick:R},"âœ•"),e("button",{onClick:V,class:"signout-btn mobile-signout"},"Sign Out")])):C("",!0),e("div",rt,[M.value?(u(),v("div",ut,[e("div",{class:Q(["form",{edge_form:x(K)}])},[e("div",dt,[e("p",{class:"Video_Title",style:fe({display:x(w)?"block":"none"})},N(x(w)),5),q(e("img",{class:"thumbnail",src:k.value,alt:"Thumbnail"},null,8,ct),[[ee,k.value]]),e("div",vt,[e("div",ft,[q(e("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>a.value=i),onKeydown:se(le(t,["prevent"]),["enter"]),onPaste:s,type:"text",placeholder:"Paste video URL...",autofocus:"",required:"",class:Q({edge_formInput:x(K)})},null,42,pt),[[ne,a.value]]),e("button",{disabled:O.value||D.value,onClick:t,class:Q(["btn",[{readjust_btn:O.value},{"error-btn":x(T)}]])},[O.value?(u(),v("div",wt,l[5]||(l[5]=[e("div",{class:"loader"},null,-1)]))):(u(),v("div",gt,l[4]||(l[4]=[e("svg",{width:"64",height:"32",viewBox:"0 0 32 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"white","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round",class:"arrow-icon"},[e("path",{d:"M3 12h24M21 6l8 6-8 6"})],-1)])))],10,mt)]),q(e("div",yt,[c.value.length?q((u(),v("select",{key:0,"onUpdate:modelValue":l[1]||(l[1]=i=>h.value=i)},[l[6]||(l[6]=e("option",{value:""},"Select Video Format",-1)),(u(!0),v(G,null,te(c.value,i=>(u(),v("option",{key:i.id,value:i.id},N(i.label),9,ht))),128))],512)),[[ve,h.value]]):C("",!0),y.value.length?q((u(),v("select",{key:1,"onUpdate:modelValue":l[2]||(l[2]=i=>g.value=i)},[l[7]||(l[7]=e("option",{value:""},"Select Audio Format",-1)),(u(!0),v(G,null,te(y.value,i=>(u(),v("option",{key:i.id,value:i.id},N(i.label),9,_t))),128))],512)),[[ve,g.value]]):C("",!0)],512),[[ee,c.value.length||y.value.length]]),e("div",bt,[q(e("button",{id:"downloadBtn",class:Q(["btn",[{readjust_downloadBtn:D.value},{"error-btn":x(L)}]]),disabled:D.value,onClick:_},[D.value?(u(),v("div",Ct,l[9]||(l[9]=[e("div",{class:"loader"},null,-1)]))):(u(),v("div",$t,l[8]||(l[8]=[e("svg",{width:"32",height:"48",viewBox:"0 0 24 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"white","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round",class:"arrow-icon"},[e("path",{d:"M12 3v24M6 21l6 8 6-8"})],-1)])))],10,kt),[[ee,r.value.length]])])])])],2),e("section",null,[Z(We)]),Z(ae,{name:"slide"},{default:oe(()=>[B.value?(u(),v("div",St,[e("button",{class:"close-btn",onClick:J},"âœ•"),e("ul",It,[x(S)?(u(),v("li",Tt,l[10]||(l[10]=[m(" ğŸ”’ Completed downloads stay available for ",-1),e("strong",null,"2 hours",-1),m(". ",-1)]))):C("",!0),x(S)?(u(),v("li",Ut,l[11]||(l[11]=[m(" â³ Incomplete downloads expire after ",-1),e("strong",null,"6 hours",-1),m(". ",-1)]))):C("",!0),l[12]||(l[12]=e("li",null,[m(" âš ï¸ Some media resolutions may show "),e("strong",null,"0â€¯MB"),m(" size, but they are still downloadable. ")],-1)),l[13]||(l[13]=e("li",null,[m(" âš™ï¸ Fetching resolution, restarting or fixing a broken download may take "),e("strong",null,"10â€“30s"),m(". ")],-1)),l[14]||(l[14]=e("li",null," ğŸŒ Some video qualities may be geoâ€‘restricted. If a download fails, retryâ€”or enable a VPN and try again. ",-1))])])):C("",!0)]),_:1}),B.value?C("",!0):(u(),v("button",{key:0,class:"open-btn",onClick:J},"â„¹ï¸"))])):(u(),ke(at,{key:0,onLoggedIn:W}))])],64))}};$e(Dt).mount("#app");
