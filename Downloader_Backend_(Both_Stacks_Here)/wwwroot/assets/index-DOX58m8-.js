var pe=Object.defineProperty,ge=Object.defineProperties;var we=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var ue=(b,d,n)=>d in b?pe(b,d,{enumerable:!0,configurable:!0,writable:!0,value:n}):b[d]=n,de=(b,d)=>{for(var n in d||(d={}))ye.call(d,n)&&ue(b,n,d[n]);if(re)for(var n of re(d))he.call(d,n)&&ue(b,n,d[n]);return b},ce=(b,d)=>ge(b,we(d));var K=(b,d,n)=>new Promise((y,a)=>{var c=p=>{try{_(n.next(p))}catch($){a($)}},h=p=>{try{_(n.throw(p))}catch($){a($)}},_=p=>p.done?y(p.value):Promise.resolve(p.value).then(c,h);_((n=n.apply(b,d)).next())});import{r as f,a as X,o as Y,b as _e,c as v,d as u,e,F as W,f as te,g as w,t as F,n as fe,h as S,u as R,w as be,i as Z,j as oe,k as q,l as se,m as le,v as ne,T as ae,p as ke,q as Q,s as ee,x as ve,y as $e}from"./vendor-D-yHDbPd.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))y(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&y(h)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function y(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();const me=(b,d)=>{const n=b.__vccOpts||b;for(const[y,a]of d)n[y]=a;return n},Ce={id:"downloads"},Se=["src"],Ie={class:"right-controls small-overlay"},Te=["onClick"],Ue=["onClick","disabled"],De={class:"info"},Ee={class:"top-controls"},Oe={class:"title"},Me={class:"right-controls desktop-only"},Le=["onClick"],Re=["onClick","disabled"],xe={class:"progress-bar-container"},Ne={class:"details"},Fe={class:"buttons"},Pe=["onClick","disabled"],Ae=["onClick","disabled"],Ke=["onClick","disabled"],Be=["onClick","disabled"],Ve=["onClick","disabled"],qe=["onClick","disabled"],Je=3e4,ze={__name:"Downloads",setup(b){const d=f([]),n=X({});let y="http://localhost:5050/Downloader",a=f(""),c=f(!1),h;function _(){return K(this,null,function*(){try{const t=yield(yield fetch(`${y}/progress?Key=${a.value}`)).json();d.value=t.map(o=>{var A,C,z,i;n[o.id]||(n[o.id]=o.url);const g=o.status==="completed",U=g?(A=o.total)!=null?A:0:(C=o.downloaded)!=null?C:0,V=g?"0":(z=o.speed)!=null?z:"N/A";return ce(de({},o),{title:o.title||o.url,downloaded:U,total:(i=o.total)!=null?i:0,speed:V})})}catch(s){if(s.message.includes("Not Found"))return;B(s,"updateProgress")}})}function p(s){return K(this,null,function*(){if(c)try{const t=`${y}/download-file/${s}`;window.open(t,"_blank")}catch(t){console.log(t.message)}})}function $(){return K(this,null,function*(){try{let t=yield(yield fetch(`${y}/OS_Check`)).json();t.is_download_enabled?c.value=!0:c.value=!1,console.log("OS -->",t)}catch(s){console.log(s.message)}})}Y(()=>{a.value=localStorage.getItem("MediaDownloaderUserKey"),$(),_(),h=setInterval(_,1500)}),_e(()=>clearInterval(h));function O(s,t){try{return fetch(`${y}/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(o){B(o,`postAction(${s})`)}}const T=s=>O("pause",{jobId:s}),M=s=>O("resume",{jobId:s}),D=s=>O("delete-ui",{jobId:s}),E=s=>O("delete-file",{jobId:s}),x=s=>{var t,o;try{const g=(o=(t=d.value.find(U=>U.id===s))==null?void 0:t.progress)!=null?o:0;k[s]=!0,J(s,g),O("resume-fresh",{jobId:s})}catch(g){console.log(g.message)}};function m(s){return K(this,null,function*(){var t,o;try{const g=prompt("Enter new URL to resume the download:");if(g!=null&&g.trim()){const U=(o=(t=d.value.find(V=>V.id===s))==null?void 0:t.progress)!=null?o:0;k[s]=!0,J(s,U),yield O("resume-new-url",{jobId:s,newUrl:g.trim()})}else alert("No URL entered. Resume cancelled.")}catch(g){console.log(g.message)}})}function L(s){const t=n[s];t?navigator.clipboard.writeText(t).then(()=>alert("âœ… Video URL copied!")).catch(()=>alert("âŒ Failed to copy")):alert("âš ï¸ Original URL not found.")}let I=0;function B(s,t="action"){const g=s instanceof TypeError&&s.message.includes("fetch")||s.message.includes("Failed to fetch")?"ğŸš¨ Server unreachable. Try again later.":s.message||"Unknown error occurred.",U=Date.now();(!I||U-I>Je)&&(alert(g),I=U),console.error(`Error during ${t}:`,s.message)}const k=X({}),P={};X({});const N={};function J(s){N[s]&&(N[s](),clearTimeout(P[s])),N[s]=be(()=>{const t=d.value.find(o=>o.id===s);return{progress:t==null?void 0:t.progress,status:t==null?void 0:t.status}},(t,o)=>{(o&&t.progress!==o.progress||t.status==="fail-err"||t.status==="failed")&&(k[s]=!1,N[s](),clearTimeout(P[s]),delete N[s])},{immediate:!1,deep:!0}),P[s]=setTimeout(()=>{k[s]=!1,N[s](),delete N[s]},3e4)}return(s,t)=>(u(),v("div",null,[t[10]||(t[10]=e("h2",{class:"heading"},"Downloads",-1)),e("div",Ce,[(u(!0),v(W,null,te(d.value,o=>{var g,U,V,A;return u(),v("div",{key:o.id,class:"download-card"},[e("img",{src:o.thumbnail,class:"thumbnail"},null,8,Se),e("div",Ie,[e("button",{onClick:C=>L(o.id),class:"icon-button copy",title:"Copy URL"},t[0]||(t[0]=[e("i",{class:"fas fa-copy"},null,-1),w(" Copy ",-1)]),8,Te),e("button",{onClick:C=>D(o.id),class:"icon-button icon-delete-ui remove",title:"Remove from UI",disabled:k[o.id]},t[1]||(t[1]=[e("i",{class:"fas fa-times"},null,-1)]),8,Ue)]),e("div",De,[e("div",Ee,[e("div",Oe,F(o.title),1),e("div",Me,[e("button",{onClick:C=>L(o.id),class:"icon-button copy",title:"Copy URL"},t[2]||(t[2]=[e("i",{class:"fas fa-copy"},null,-1),w(" Copy ",-1)]),8,Le),e("button",{onClick:C=>D(o.id),class:"icon-button icon-delete-ui remove",title:"Remove from UI",disabled:k[o.id]},t[3]||(t[3]=[e("i",{class:"fas fa-times"},null,-1)]),8,Re)])]),e("div",xe,[e("div",{class:"progress-bar",style:fe({width:((U=(g=o.progress)==null?void 0:g.toFixed(2))!=null?U:0)+"%"})},null,4)]),e("div",Ne,[e("span",null,F(o.downloaded)+" MB / "+F(o.total)+" MB",1),e("span",null,"Speed: "+F(o.speed)+F(o.speed!=="N/A"&&o.speed!=="0"?"/s":""),1),e("span",null,"Progress: "+F((A=(V=o.progress)==null?void 0:V.toFixed(2))!=null?A:0)+"%",1),e("span",null,"Job: "+F(o.status),1)]),e("div",Fe,[e("button",{onClick:C=>T(o.id),class:"btn pause",disabled:k[o.id]},t[4]||(t[4]=[e("i",{class:"fas fa-pause"},null,-1),w(" Pause ",-1)]),8,Pe),e("button",{onClick:C=>M(o.id),class:"btn resume",disabled:k[o.id]},t[5]||(t[5]=[e("i",{class:"fas fa-play"},null,-1),w(" Resume ",-1)]),8,Ae),e("button",{onClick:C=>x(o.id),class:"btn restart",disabled:k[o.id]},t[6]||(t[6]=[e("i",{class:"fas fa-redo"},null,-1),w(" Restart ",-1)]),8,Ke),e("button",{onClick:C=>m(o.id),class:"btn resume_broken",disabled:k[o.id]},t[7]||(t[7]=[e("i",{class:"fas fa-link"},null,-1),w(" Fix URL ",-1)]),8,Be),e("button",{onClick:C=>E(o.id),class:"btn delete icon-delete-file",disabled:k[o.id]},t[8]||(t[8]=[e("i",{class:"fas fa-trash"},null,-1),w(" Delete File ",-1)]),8,Ve),R(c)?(u(),v("button",{key:0,onClick:C=>p(o.id),class:"btn download",disabled:o.status!=="completed"},t[9]||(t[9]=[e("i",{class:"fas fa-download"},null,-1),w(" Download ",-1)]),8,qe)):S("",!0)])])])}),128))])]))}},Ge=me(ze,[["__scopeId","data-v-da8a15dd"]]),We={class:"login-page",key:"login"},He=["onKeydown"],Qe=["onKeydown"],Xe=["disabled"],Ye={key:0},Ze={key:1,class:"loader"},je={class:"modal-overlay",key:"modal"},et={class:"modal"},tt={class:"modal-list"},ot={key:0},st={key:1},lt={__name:"Login",emits:["logged-in"],setup(b,{emit:d}){const n=d;let y="";const a=f(""),c=f(""),h=f(!1),_=f(!1),p=f(null),$=f(null);let O=f(!1);Y(()=>{p.value&&p.value.focus()});function T(x){return K(this,null,function*(){const m=new TextEncoder().encode(x),L=yield crypto.subtle.digest("SHA-256",m);return Array.from(new Uint8Array(L)).map(B=>B.toString(16).padStart(2,"0")).join("")})}function M(){$.value&&$.value.focus()}function D(){return K(this,null,function*(){if(!a.value||!c.value){alert("Please enter both username and password.");return}h.value=!0;try{y=yield T(`${a.value}:${c.value}`),_.value=!0}catch(x){console.error(x),alert("Login failed; please try again.")}finally{h.value=!1}})}function E(){_.value=!1,n("logged-in",y)}return(x,m)=>(u(),v(W,null,[Z(ae,{name:"fade",mode:"out-in"},{default:oe(()=>[_.value?S("",!0):(u(),v("div",We,[m[2]||(m[2]=e("h2",{class:"login-title"},"ğŸ”’ Guest Login",-1)),q(e("input",{ref_key:"userInput",ref:p,"onUpdate:modelValue":m[0]||(m[0]=L=>a.value=L),onKeydown:se(le(M,["prevent"]),["enter"]),placeholder:"Username",class:"login-input"},null,40,He),[[ne,a.value]]),q(e("input",{ref_key:"passInput",ref:$,"onUpdate:modelValue":m[1]||(m[1]=L=>c.value=L),type:"password",placeholder:"Password",onKeydown:se(le(D,["prevent"]),["enter"]),class:"login-input"},null,40,Qe),[[ne,c.value]]),e("button",{onClick:D,disabled:h.value,class:"btn login-btn"},[h.value?(u(),v("span",Ze)):(u(),v("span",Ye,"OK"))],8,Xe)]))]),_:1}),Z(ae,{name:"fade-scale"},{default:oe(()=>[_.value?(u(),v("div",je,[e("div",et,[m[7]||(m[7]=e("h3",{class:"modal-title"},"Session Information",-1)),m[8]||(m[8]=e("p",null," Remember your username and password to view your downloads on any device with same login info. ",-1)),e("ul",tt,[R(O)?(u(),v("li",ot,m[3]||(m[3]=[w(" ğŸ”’ Completed downloads expire in ",-1),e("strong",null,"2 hours",-1),w(". ",-1)]))):S("",!0),R(O)?(u(),v("li",st,m[4]||(m[4]=[w(" â³ Incomplete downloads expire in ",-1),e("strong",null,"6 hours",-1),w(". ",-1)]))):S("",!0),m[5]||(m[5]=e("li",null,[w(" âš™ï¸ Getting resolution, restarting or fix borken link download may take "),e("strong",null,"10â€“30s"),w(". ")],-1)),m[6]||(m[6]=e("li",null," ğŸŒ Some video qualities may be area-restricted. If getting video resolution or download fails, just retryâ€”or enable a VPN and try again. ",-1))]),e("button",{onClick:E,class:"btn modal-btn"},"Understood")])])):S("",!0)]),_:1})],64))}},nt=me(lt,[["__scopeId","data-v-585da855"]]),at={key:1,class:"mobile-panel"},it={class:"container"},rt={key:1},ut={class:"inner-container"},dt=["src"],ct={class:"rows"},vt={class:"row"},ft=["onKeydown"],mt=["disabled"],pt={key:0},gt={key:1},wt={class:"row"},yt=["value"],ht=["value"],_t={class:"row"},bt=["disabled"],kt={key:0},$t={key:1},Ct={key:0,class:"info-modal"},St={class:"info-list"},It={key:0},Tt={key:1},Ut=1e3,Dt={__name:"App",setup(b){let d="http://localhost:5050/Downloader";const n=f("");let y=f("");const a=f([]),c=f([]),h=f([]),_=f(""),p=f(""),$=f(""),O=f([]);let T=f(!1),M=f(!1);const D=f(!1),E=f(!1);let x=null,m=!1,L=null;X({});const I=f(null);let B=f(!1);const k=f(!1),P=f(!1);let N=f(!1);function J(){P.value=!P.value}function s(){k.value=!k.value}Y(()=>{setTimeout(()=>{P.value=!0},1e3)}),Y(()=>{var i,l;I.value=localStorage.getItem("MediaDownloaderUserKey"),(l=(i=navigator.userAgentData)==null?void 0:i.brands)!=null&&l.some(r=>r.brand==="Microsoft Edge")&&(B.value=!0)});function t(i){I.value=i,console.log("key ",i),localStorage.setItem("MediaDownloaderUserKey",i)}function o(){setTimeout(()=>{/^https?:\/\/.+\..+/.test(n.value.trim())&&g()},10)}function g(){return K(this,null,function*(){if(D.value){console.log("Already loading formats, please wait.");return}if(n.value.trim()===""||!/^https?:\/\/.+\..+/.test(n.value.trim())){T.value=!0,setTimeout(()=>{T.value=!1,alert("Please enter a valid URL.")},600);return}D.value=!0,$.value="",y.value="",a.value=[],c.value=[],h.value=[];try{const i=yield fetch(`${d}/formats`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:n.value})});if(!i.ok)throw new Error(yield i.text());const l=yield i.json();if(l.loginRequired){T.value=!0,setTimeout(()=>{T.value=!1,window.alert(l.message||"Incorrect URL / Login required"),window.open(l.url,"_blank")},600);return}if(console.log("Received formats:",l),l.length===0){T.value=!0,setTimeout(()=>{T.value=!1,alert("No Media Format Found.")},600);return}_.value="",p.value="",a.value=l,l.forEach(r=>{const H=r.label||"";r.thumbnail&&($.value=r.thumbnail),r.title&&(y.value=r.title);const j=/\b\d{2,4}x\d{2,4}\b/.test(H),G=r.isAudioOnly||H.toLowerCase().includes("audio only"),ie=r.isVideoOnly||/\b\d{3,4}p\b/.test(H)||j;ie&&!G?c.value.push(r):G&&!ie?h.value.push(r):c.value.push(r)})}catch(i){console.error(i),T.value=!0,C(i,"getFormats","F")}finally{D.value=!1}})}function U(){return`dl_${Date.now()}_${Math.floor(Math.random()*1e6)}`}function V(){return K(this,null,function*(){if(E.value){console.log("Download already in progress, please wait.");return}if(n.value.trim()===""||!/^https?:\/\/.+\..+/.test(n.value.trim())){M.value=!0,setTimeout(()=>{M.value=!1,alert("Please enter a valid URL.")},600);return}m=!1,L=U();try{let i="";if(_.value&&p.value?i=`${_.value}+${p.value}`:_.value?i=_.value:p.value&&(i=p.value),!i){M.value=!0,setTimeout(()=>{M.value=!1,alert("Please select format.")},600);return}E.value=!0;let l={url:n.value,format:i,DownloadId:L,Thumbnail:$.value,Key:I.value};console.log("sending to BE ",l);const r=yield fetch(`${d}/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!r.ok)throw new Error(yield r.text());x&&clearTimeout(x),x=setTimeout(()=>{m||(E.value=!1)},1e4)}catch(i){console.error(i),M.value=!0,C(i,"startDownload","D"),E.value=!1}})}let A=0;function C(i,l="action",r){const j=i instanceof TypeError&&i.message.includes("fetch")||i.message.includes("Failed to fetch")?"ğŸš¨ Server unreachable. Try again later.":i.message||"Unknown error occurred.",G=Date.now();(!A||G-A>Ut)&&(setTimeout(()=>{r=="D"?M.value=!1:r=="F"&&(T.value=!1),alert(j)},600),A=G),console.error(`Error during ${l}:`,i.message)}function z(){k.value=!1,localStorage.removeItem("MediaDownloaderUserKey"),I.value=null,n.value="",y.value="",a.value=[],c.value=[],h.value=[],_.value="",p.value="",$.value="",O.value=[],window.location.reload()}return(i,l)=>(u(),v(W,null,[e("header",null,[l[3]||(l[3]=e("h1",null,"ğŸš€ Media Downloader",-1)),I.value?(u(),v("button",{key:0,onClick:z,class:"signout-btn desktop-signout",title:"Sign Out"}," Sign Out ")):S("",!0),I.value?(u(),v("button",{key:1,onClick:s,class:"menu-toggle mobile-only",title:"Menu"}," â‰¡ ")):S("",!0)]),I.value&&k.value?(u(),v("div",{key:0,class:"mobile-panel-overlay",onClick:s})):S("",!0),I.value&&k.value?(u(),v("div",at,[e("button",{class:"close-panel-btn",onClick:s},"âœ•"),e("button",{onClick:z,class:"signout-btn mobile-signout"},"Sign Out")])):S("",!0),e("div",it,[I.value?(u(),v("div",rt,[e("div",{class:Q(["form",{edge_form:R(B)}])},[e("div",ut,[e("p",{class:"Video_Title",style:fe({display:R(y)?"block":"none"})},F(R(y)),5),q(e("img",{class:"thumbnail",src:$.value,alt:"Thumbnail"},null,8,dt),[[ee,$.value]]),e("div",ct,[e("div",vt,[q(e("input",{"onUpdate:modelValue":l[0]||(l[0]=r=>n.value=r),onKeydown:se(le(g,["prevent"]),["enter"]),onPaste:o,type:"text",placeholder:"Paste video URL...",autofocus:"",required:"",class:Q({edge_formInput:R(B)})},null,42,ft),[[ne,n.value]]),e("button",{disabled:D.value||E.value,onClick:g,class:Q(["btn",[{readjust_btn:D.value},{"error-btn":R(T)}]])},[D.value?(u(),v("div",gt,l[5]||(l[5]=[e("div",{class:"loader"},null,-1)]))):(u(),v("div",pt,l[4]||(l[4]=[e("svg",{width:"64",height:"32",viewBox:"0 0 32 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"white","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round",class:"arrow-icon"},[e("path",{d:"M3 12h24M21 6l8 6-8 6"})],-1)])))],10,mt)]),q(e("div",wt,[c.value.length?q((u(),v("select",{key:0,"onUpdate:modelValue":l[1]||(l[1]=r=>_.value=r)},[l[6]||(l[6]=e("option",{value:""},"Select Video Format",-1)),(u(!0),v(W,null,te(c.value,r=>(u(),v("option",{key:r.id,value:r.id},F(r.label),9,yt))),128))],512)),[[ve,_.value]]):S("",!0),h.value.length?q((u(),v("select",{key:1,"onUpdate:modelValue":l[2]||(l[2]=r=>p.value=r)},[l[7]||(l[7]=e("option",{value:""},"Select Audio Format",-1)),(u(!0),v(W,null,te(h.value,r=>(u(),v("option",{key:r.id,value:r.id},F(r.label),9,ht))),128))],512)),[[ve,p.value]]):S("",!0)],512),[[ee,c.value.length||h.value.length]]),e("div",_t,[q(e("button",{id:"downloadBtn",class:Q(["btn",[{readjust_downloadBtn:E.value},{"error-btn":R(M)}]]),disabled:E.value,onClick:V},[E.value?(u(),v("div",$t,l[9]||(l[9]=[e("div",{class:"loader"},null,-1)]))):(u(),v("div",kt,l[8]||(l[8]=[e("svg",{width:"32",height:"48",viewBox:"0 0 24 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"white","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round",class:"arrow-icon"},[e("path",{d:"M12 3v24M6 21l6 8 6-8"})],-1)])))],10,bt),[[ee,a.value.length]])])])])],2),e("section",null,[Z(Ge)]),Z(ae,{name:"slide"},{default:oe(()=>[P.value?(u(),v("div",Ct,[e("button",{class:"close-btn",onClick:J},"âœ•"),e("ul",St,[R(N)?(u(),v("li",It,l[10]||(l[10]=[w(" ğŸ”’ Completed downloads stay available for ",-1),e("strong",null,"2 hours",-1),w(". ",-1)]))):S("",!0),R(N)?(u(),v("li",Tt,l[11]||(l[11]=[w(" â³ Incomplete downloads expire after ",-1),e("strong",null,"6 hours",-1),w(". ",-1)]))):S("",!0),l[12]||(l[12]=e("li",null,[w(" âš ï¸ Some media resolutions may show "),e("strong",null,"0â€¯MB"),w(" size, but they are still downloadable. ")],-1)),l[13]||(l[13]=e("li",null,[w(" âš™ï¸ Fetching resolution, restarting or fixing a broken download may take "),e("strong",null,"10â€“30s"),w(". ")],-1)),l[14]||(l[14]=e("li",null," ğŸŒ Some video qualities may be geoâ€‘restricted. If a download fails, retryâ€”or enable a VPN and try again. ",-1))])])):S("",!0)]),_:1}),P.value?S("",!0):(u(),v("button",{key:0,class:"open-btn",onClick:J},"â„¹ï¸"))])):(u(),ke(nt,{key:0,onLoggedIn:t}))])],64))}};$e(Dt).mount("#app");
